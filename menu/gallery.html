<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ovitalab - NASA Gallery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Space Grotesk", sans-serif;
            color: #ffffff;
            background: #000000;
            min-height: 100vh;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }

        /* Minimalist animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.01) 1px, transparent 1px);
            background-size: 100px 100px, 150px 150px;
            pointer-events: none;
            z-index: -1;
            animation: drift 30s ease-in-out infinite alternate;
        }

        @keyframes drift {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-20px, -20px); }
        }

        /* Header styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo img {
            height: 60px;
            width: auto;
            transition: all 0.3s ease;
            filter: brightness(0) invert(1);
        }

        .logo img:hover {
            transform: scale(1.05);
            filter: brightness(0) invert(1) drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
        }

        /* Search bar */
        .search-container {
            padding: 30px 0;
            margin-top: 100px;
            text-align: center;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-bar {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            display: flex;
            gap: 15px;
            padding: 0 20px;
        }

        .search-bar input {
            flex: 1;
            padding: 18px 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #ffffff;
            font-size: 1.1rem;
            outline: none;
            transition: all 0.3s ease;
            font-family: "Space Grotesk", sans-serif;
        }

        .search-bar input:focus {
            border-color: #ffffff;
            background: rgba(0, 0, 0, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
        }

        .search-bar input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Black and white buttons */
        .btn {
            padding: 15px 30px;
            border: 2px solid #ffffff;
            border-radius: 0;
            background: transparent;
            color: #ffffff;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-align: center;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: "Space Grotesk", sans-serif;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: #ffffff;
            transition: left 0.3s ease;
            z-index: -1;
        }

        .btn:hover::before {
            left: 0;
        }

        .btn:hover {
            color: #000000;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.2);
        }

        .btn-primary {
            background: #ffffff;
            color: #000000;
            border-color: #ffffff;
        }

        .btn-primary::before {
            background: #000000;
        }

        .btn-primary:hover {
            color: #ffffff;
            background: transparent;
        }

        .btn-secondary {
            background: transparent;
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.5);
        }

        .btn-secondary:hover {
            border-color: #ffffff;
        }

        .btn-sm {
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        .btn-lg {
            padding: 20px 40px;
            font-size: 1.2rem;
        }

        /* Main content */
        main {
            padding: 30px 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Section styles */
        .section {
            margin-bottom: 80px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 40px;
            position: relative;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 30px;
        }

        .section-header h2 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            color: #ffffff;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .section-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
            font-weight: 300;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls select,
        .controls input[type="date"],
        .controls input[type="text"] {
            padding: 12px 18px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #ffffff;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            min-width: 150px;
            font-family: "Space Grotesk", sans-serif;
        }

        .controls select:focus,
        .controls input:focus {
            border-color: #ffffff;
            background: #000000;
            transform: translateY(-2px);
        }

        /* Enhanced 16:9 Gallery grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .gallery-item {
            position: relative;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.9);
            transition: all 0.4s ease;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
            aspect-ratio: 16/9;
            display: flex;
            flex-direction: column;
        }

        .gallery-item:hover {
            transform: translateY(-10px);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 40px rgba(255, 255, 255, 0.1);
        }

        .gallery-item-image {
            width: 100%;
            height: 70%;
            overflow: hidden;
            position: relative;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.4s ease;
            /* Removed grayscale filter to keep images colorful */
        }

        .gallery-item:hover img {
            transform: scale(1.05);
            filter: brightness(1.1) contrast(1.1) saturate(1.2);
        }

        .gallery-item-info {
            padding: 20px;
            background: rgba(0, 0, 0, 0.95);
            height: 30%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .gallery-item-info h4 {
            color: #ffffff;
            margin-bottom: 8px;
            font-size: 1.1rem;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.3;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .gallery-item-info p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            margin-bottom: 8px;
            line-height: 1.4;
            font-weight: 300;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .gallery-item-actions {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .gallery-item-actions .btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.8rem;
        }

        /* Enhanced APOD styles with 16:9 */
        .apod-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .apod-image {
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            aspect-ratio: 16/9;
        }

        .apod-image img,
        .apod-image iframe {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.4s ease;
            /* Removed grayscale filter to keep images colorful */
        }

        .apod-image:hover img {
            transform: scale(1.02);
            filter: brightness(1.1) contrast(1.1) saturate(1.2);
        }

        .apod-info {
            padding: 30px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .apod-info h3 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 1.8rem;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 2px;
            line-height: 1.3;
        }

        .apod-info .date {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
            margin-bottom: 20px;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
        }

        .apod-info p {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 25px;
            font-size: 0.95rem;
            font-weight: 300;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 6;
            -webkit-box-orient: vertical;
        }

        /* Slideshow with 16:9 */
        .slideshow-container {
            position: relative;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            aspect-ratio: 16/9;
        }

        .slideshow {
            display: none;
            text-align: center;
            background: rgba(0, 0, 0, 0.9);
            height: 100%;
            position: relative;
        }

        .slideshow.active {
            display: flex;
            flex-direction: column;
        }

        .slideshow img {
            width: 100%;
            height: 70%;
            object-fit: cover;
            /* Removed grayscale filter to keep images colorful */
        }

        .slideshow-content {
            padding: 20px;
            height: 30%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: rgba(0, 0, 0, 0.95);
        }

        .slideshow h3 {
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 1.5rem;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .slideshow .date {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .slideshow-nav {
            text-align: center;
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Modal with enhanced image display */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            overflow-y: auto;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.98);
            margin: 50px auto;
            padding: 40px;
            width: 90%;
            max-width: 1200px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 25px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .modal-close:hover {
            color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .modal img {
            width: 100%;
            max-height: 70vh;
            object-fit: contain;
            margin-bottom: 20px;
            /* Removed grayscale filter to keep images colorful */
        }

        .modal h3 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.8rem;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .modal p {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 20px;
            font-weight: 300;
        }

        /* Loading spinner */
        .loading {
            text-align: center;
            padding: 60px;
            color: #ffffff;
        }

        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top: 2px solid #ffffff;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Footer styles */
        footer {
            padding: 40px 50px;
            background: rgba(0, 0, 0, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 60px;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
        }

        .footer-links {
            margin-bottom: 20px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .footer-links a:hover {
            color: #ffffff;
        }

        /* Responsive design */
        @media (max-width: 1200px) {
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .apod-container {
                grid-template-columns: 1fr;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .section-header h2 {
                font-size: 2.2rem;
            }

            .section {
                padding: 25px;
                margin-bottom: 50px;
            }

            .btn {
                padding: 12px 25px;
                font-size: 0.95rem;
            }

            .gallery-item-info {
                padding: 15px;
            }

            .gallery-item-info h4 {
                font-size: 1rem;
            }

            .gallery-item-info p {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .gallery-grid {
                grid-template-columns: 1fr;
            }

            .search-bar {
                flex-direction: column;
                gap: 15px;
            }

            .gallery-item-actions {
                flex-direction: column;
            }

            .slideshow-nav {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.8);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo">
            <img src="../logo.png" alt="Ovitalab Logo">
        </div>
    </header>

    <div class="search-container">
        <div class="search-bar">
            <input type="text" id="globalSearch" placeholder="Search NASA images and videos...">
            <button class="btn btn-primary" onclick="performGlobalSearch()">
                <i class="fas fa-search"></i> Search
            </button>
        </div>
    </div>

    <main>
        <!-- APOD Section -->
        <section class="section">
            <div class="section-header">
                <h2><i class="fas fa-star"></i> Astronomy Picture of the Day</h2>
                <p>Daily space photography with stunning visuals</p>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="apodDate">Select Date:</label>
                    <input type="date" id="apodDate" onchange="loadAPOD()">
                </div>
                <button class="btn btn-primary" onclick="loadTodayAPOD()">
                    <i class="fas fa-calendar-day"></i> Today's Image
                </button>
                <button class="btn btn-secondary" onclick="loadWeekSlideshow()">
                    <i class="fas fa-images"></i> Week Gallery
                </button>
            </div>

            <div id="apodContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading Astronomy Picture of the Day...</p>
                </div>
            </div>

            <div id="slideshowContainer" class="slideshow-container" style="display: none;">
                <div class="slideshow-nav">
                    <button class="btn btn-secondary btn-sm" onclick="prevSlide()">
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="nextSlide()">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="toggleAutoplay()" id="autoplayBtn">
                        <i class="fas fa-play"></i> Auto Play
                    </button>
                </div>
            </div>
        </section>

        <!-- NASA Image & Video Library -->
        <section class="section">
            <div class="section-header">
                <h2><i class="fas fa-images"></i> NASA Image & Video Library</h2>
                <p>Explore space imagery and video content</p>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="librarySearch">Search Keywords:</label>
                    <input type="text" id="librarySearch" placeholder="e.g., nebula, mars, apollo">
                </div>
                <div class="control-group">
                    <label for="mediaType">Media Type:</label>
                    <select id="mediaType">
                        <option value="">All</option>
                        <option value="image">Images</option>
                        <option value="video">Videos</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="searchNASALibrary()">
                    <i class="fas fa-search"></i> Search Library
                </button>
            </div>

            <div id="libraryResults" class="gallery-grid"></div>
            <div style="text-align: center;">
                <button id="loadMoreBtn" class="btn btn-secondary" onclick="loadMoreResults()" style="display: none;">
                    <i class="fas fa-plus"></i> Load More
                </button>
            </div>
        </section>

        <!-- Mars Rover Photos -->
        <section class="section">
            <div class="section-header">
                <h2><i class="fas fa-robot"></i> Mars Rover Photography</h2>
                <p>High-resolution images from Mars exploration rovers</p>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="roverSelect">Rover:</label>
                    <select id="roverSelect">
                        <option value="curiosity">Curiosity</option>
                        <option value="perseverance">Perseverance</option>
                        <option value="opportunity">Opportunity</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="roverDate">Date:</label>
                    <input type="date" id="roverDate">
                </div>
                <div class="control-group">
                    <label for="cameraSelect">Camera:</label>
                    <select id="cameraSelect">
                        <option value="">All Cameras</option>
                        <option value="FHAZ">Front Hazard Avoidance</option>
                        <option value="RHAZ">Rear Hazard Avoidance</option>
                        <option value="MAST">Mast Camera</option>
                        <option value="CHEMCAM">Chemistry Camera</option>
                        <option value="MAHLI">Hand Lens Imager</option>
                        <option value="MARDI">Descent Imager</option>
                        <option value="NAVCAM">Navigation Camera</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="loadRoverPhotos()">
                    <i class="fas fa-camera"></i> Load Photos
                </button>
            </div>

            <div id="roverResults" class="gallery-grid"></div>
        </section>

        <!-- EPIC Earth Images -->
        <section class="section">
            <div class="section-header">
                <h2><i class="fas fa-globe"></i> Earth from Space</h2>
                <p>Real-time Earth imagery from DSCOVR satellite</p>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="loadEPICImages()">
                    <i class="fas fa-globe-americas"></i> Load Earth Images
                </button>
                <button class="btn btn-secondary" onclick="animateEarth()">
                    <i class="fas fa-sync-alt"></i> Animate Earth
                </button>
            </div>

            <div id="epicResults" class="gallery-grid"></div>
        </section>
    </main>

    <!-- Modal for detailed view -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="cs.html">Privacy Policy</a> | <a href="tu.html">Tools</a>
            </div>
            <p>Ovitalab © 2025</p>
        </div>
    </footer>

    <script>
        // NASA API Configuration
        const NASA_API_KEY = '5Rp7OJsznN6GDZwjgPSqcsiMNYfCZpQvflhFARpk';
        const NASA_APIS = {
            APOD: 'https://api.nasa.gov/planetary/apod',
            LIBRARY: 'https://images-api.nasa.gov/search',
            MARS_ROVER: 'https://api.nasa.gov/mars-photos/api/v1/rovers',
            EPIC: 'https://api.nasa.gov/EPIC/api/natural/images'
        };

        // Global variables
        let currentSlideIndex = 0;
        let slideshowData = [];
        let autoplayInterval = null;
        let libraryPage = 1;
        let currentLibraryQuery = '';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('apodDate').value = today;
            document.getElementById('roverDate').value = today;
            loadTodayAPOD();
        });

        // Global search function
        function performGlobalSearch() {
            const query = document.getElementById('globalSearch').value;
            if (query.trim()) {
                document.getElementById('librarySearch').value = query;
                searchNASALibrary();
                document.querySelector('#libraryResults').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // APOD Functions
        async function loadTodayAPOD() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('apodDate').value = today;
            await loadAPOD();
        }

        async function loadAPOD() {
            const date = document.getElementById('apodDate').value;
            const container = document.getElementById('apodContainer');
            
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading image...</p></div>';

            try {
                const response = await fetch(`${NASA_APIS.APOD}?api_key=${NASA_API_KEY}&date=${date}`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                container.innerHTML = `
                    <div class="apod-container">
                        <div class="apod-image">
                            ${data.media_type === 'video' 
                                ? `<iframe src="${data.url}" frameborder="0" allowfullscreen></iframe>`
                                : `<img src="${data.hdurl || data.url}" alt="${data.title}" onclick="openModal('${data.hdurl || data.url}', '${data.title}', '${data.explanation}')">`
                            }
                        </div>
                        <div class="apod-info">
                            <div class="date">${formatDate(data.date)}</div>
                            <h3>${data.title}</h3>
                            <p>${data.explanation}</p>
                            <div class="gallery-item-actions">
                                <button class="btn btn-primary btn-sm" onclick="downloadImage('${data.hdurl || data.url}', '${data.title}')">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="shareContent('${data.title}', '${data.url}')">
                                    <i class="fas fa-share"></i> Share
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `<div class="error">Error loading image: ${error.message}</div>`;
            }
        }

        async function loadWeekSlideshow() {
            const container = document.getElementById('slideshowContainer');
            container.style.display = 'block';
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading gallery...</p></div>';

            try {
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(endDate.getDate() - 6);

                const response = await fetch(`${NASA_APIS.APOD}?api_key=${NASA_API_KEY}&start_date=${startDate.toISOString().split('T')[0]}&end_date=${endDate.toISOString().split('T')[0]}`);
                slideshowData = await response.json();

                if (slideshowData.error) {
                    throw new Error(slideshowData.error.message);
                }

                currentSlideIndex = 0;
                displaySlideshow();
            } catch (error) {
                container.innerHTML = `<div class="error">Error loading gallery: ${error.message}</div>`;
            }
        }

        function displaySlideshow() {
            const container = document.getElementById('slideshowContainer');
            if (slideshowData.length === 0) return;

            const slides = slideshowData.map((item, index) => `
                <div class="slideshow ${index === currentSlideIndex ? 'active' : ''}">
                    <img src="${item.url}" alt="${item.title}">
                    <div class="slideshow-content">
                        <h3>${item.title}</h3>
                        <p class="date">${formatDate(item.date)}</p>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                ${slides}
                <div class="slideshow-nav">
                    <button class="btn btn-secondary btn-sm" onclick="prevSlide()">
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="nextSlide()">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="toggleAutoplay()" id="autoplayBtn">
                        <i class="fas fa-play"></i> Auto Play
                    </button>
                </div>
            `;
        }

        function prevSlide() {
            if (slideshowData.length === 0) return;
            currentSlideIndex = (currentSlideIndex - 1 + slideshowData.length) % slideshowData.length;
            updateSlideshow();
        }

        function nextSlide() {
            if (slideshowData.length === 0) return;
            currentSlideIndex = (currentSlideIndex + 1) % slideshowData.length;
            updateSlideshow();
        }

        function updateSlideshow() {
            const slides = document.querySelectorAll('.slideshow');
            slides.forEach((slide, index) => {
                slide.classList.toggle('active', index === currentSlideIndex);
            });
        }

        function toggleAutoplay() {
            const btn = document.getElementById('autoplayBtn');
            if (autoplayInterval) {
                clearInterval(autoplayInterval);
                autoplayInterval = null;
                btn.innerHTML = '<i class="fas fa-play"></i> Auto Play';
            } else {
                autoplayInterval = setInterval(nextSlide, 3000);
                btn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            }
        }

        // NASA Library Functions
        async function searchNASALibrary() {
            const query = document.getElementById('librarySearch').value;
            const mediaType = document.getElementById('mediaType').value;
            
            if (!query.trim()) {
                alert('Please enter a search term');
                return;
            }

            currentLibraryQuery = query;
            libraryPage = 1;
            
            const container = document.getElementById('libraryResults');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Searching library...</p></div>';

            try {
                let url = `${NASA_APIS.LIBRARY}?q=${encodeURIComponent(query)}&page=${libraryPage}`;
                if (mediaType) {
                    url += `&media_type=${mediaType}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                displayLibraryResults(data.collection.items, true);
                
                const loadMoreBtn = document.getElementById('loadMoreBtn');
                loadMoreBtn.style.display = data.collection.items.length >= 100 ? 'block' : 'none';
            } catch (error) {
                container.innerHTML = `<div class="error">Error searching library: ${error.message}</div>`;
            }
        }

        async function loadMoreResults() {
            libraryPage++;
            const mediaType = document.getElementById('mediaType').value;
            
            try {
                let url = `${NASA_APIS.LIBRARY}?q=${encodeURIComponent(currentLibraryQuery)}&page=${libraryPage}`;
                if (mediaType) {
                    url += `&media_type=${mediaType}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                displayLibraryResults(data.collection.items, false);
                
                const loadMoreBtn = document.getElementById('loadMoreBtn');
                loadMoreBtn.style.display = data.collection.items.length < 100 ? 'none' : 'block';
            } catch (error) {
                console.error('Error loading more results:', error);
            }
        }

        function displayLibraryResults(items, replace = true) {
            const container = document.getElementById('libraryResults');
            
            if (replace) {
                container.innerHTML = '';
            }

            items.forEach(item => {
                const data = item.data[0];
                const links = item.links || [];
                const thumbnail = links.find(link => link.rel === 'preview');
                
                if (thumbnail) {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'gallery-item';
                    itemElement.innerHTML = `
                        <div class="gallery-item-image">
                            <img src="${thumbnail.href}" alt="${data.title}" loading="lazy">
                        </div>
                        <div class="gallery-item-info">
                            <h4>${data.title}</h4>
                            <p>${data.description ? data.description.substring(0, 80) + '...' : 'No description available'}</p>
                            <p><small>Date: ${formatDate(data.date_created)}</small></p>
                            <div class="gallery-item-actions">
                                <button class="btn btn-primary btn-sm" onclick="downloadImage('${thumbnail.href}', '${data.title}')">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="shareContent('${data.title}', '${thumbnail.href}')">
                                    <i class="fas fa-share"></i> Share
                                </button>
                            </div>
                        </div>
                    `;
                    
                    itemElement.onclick = () => openModal(thumbnail.href, data.title, data.description);
                    container.appendChild(itemElement);
                }
            });
        }

        // Mars Rover Functions
        async function loadRoverPhotos() {
            const rover = document.getElementById('roverSelect').value;
            const date = document.getElementById('roverDate').value;
            const camera = document.getElementById('cameraSelect').value;
            
            const container = document.getElementById('roverResults');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading Mars photos...</p></div>';

            try {
                let url = `${NASA_APIS.MARS_ROVER}/${rover}/photos?api_key=${NASA_API_KEY}&earth_date=${date}`;
                if (camera) {
                    url += `&camera=${camera}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.photos.length === 0) {
                    container.innerHTML = '<div class="error">No photos found for the selected date and camera.</div>';
                    return;
                }

                container.innerHTML = '';
                data.photos.slice(0, 20).forEach(photo => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'gallery-item';
                    itemElement.innerHTML = `
                        <div class="gallery-item-image">
                            <img src="${photo.img_src}" alt="Mars photo from ${photo.camera.full_name}" loading="lazy">
                        </div>
                        <div class="gallery-item-info">
                            <h4>${photo.camera.full_name}</h4>
                            <p>Sol: ${photo.sol} | Earth Date: ${photo.earth_date}</p>
                            <p>Rover: ${photo.rover.name}</p>
                            <div class="gallery-item-actions">
                                <button class="btn btn-primary btn-sm" onclick="downloadImage('${photo.img_src}', 'Mars_${photo.rover.name}_${photo.sol}')">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="shareContent('Mars photo from ${photo.rover.name}', '${photo.img_src}')">
                                    <i class="fas fa-share"></i> Share
                                </button>
                            </div>
                        </div>
                    `;
                    
                    itemElement.onclick = () => openModal(photo.img_src, `Mars photo from ${photo.camera.full_name}`, `Sol: ${photo.sol}, Earth Date: ${photo.earth_date}, Rover: ${photo.rover.name}`);
                    container.appendChild(itemElement);
                });
            } catch (error) {
                container.innerHTML = `<div class="error">Error loading rover photos: ${error.message}</div>`;
            }
        }

        // EPIC Functions
        async function loadEPICImages() {
            const container = document.getElementById('epicResults');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading Earth images...</p></div>';

            try {
                const response = await fetch(`${NASA_APIS.EPIC}?api_key=${NASA_API_KEY}`);
                const data = await response.json();

                if (data.length === 0) {
                    container.innerHTML = '<div class="error">No EPIC images available.</div>';
                    return;
                }

                container.innerHTML = '';
                data.slice(0, 12).forEach(image => {
                    const date = image.date.split(' ')[0].replace(/-/g, '/');
                    const imageUrl = `https://api.nasa.gov/EPIC/archive/natural/${date.replace(/\//g, '/')}/png/${image.image}.png?api_key=${NASA_API_KEY}`;
                    
                    const itemElement = document.createElement('div');
                    itemElement.className = 'gallery-item';
                    itemElement.innerHTML = `
                        <div class="gallery-item-image">
                            <img src="${imageUrl}" alt="Earth from EPIC" loading="lazy">
                        </div>
                        <div class="gallery-item-info">
                            <h4>Earth from Space</h4>
                            <p>Date: ${formatDate(image.date.split(' ')[0])}</p>
                            <p>Coordinates: ${image.centroid_coordinates.lat.toFixed(2)}°, ${image.centroid_coordinates.lon.toFixed(2)}°</p>
                            <div class="gallery-item-actions">
                                <button class="btn btn-primary btn-sm" onclick="downloadImage('${imageUrl}', 'Earth_EPIC_${image.date}')">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="shareContent('Earth from Space', '${imageUrl}')">
                                    <i class="fas fa-share"></i> Share
                                </button>
                            </div>
                        </div>
                    `;
                    
                    itemElement.onclick = () => openModal(imageUrl, 'Earth from EPIC', `Date: ${image.date}, Coordinates: ${image.centroid_coordinates.lat.toFixed(2)}°, ${image.centroid_coordinates.lon.toFixed(2)}°`);
                    container.appendChild(itemElement);
                });
            } catch (error) {
                container.innerHTML = `<div class="error">Error loading EPIC images: ${error.message}</div>`;
            }
        }

        async function animateEarth() {
            alert('Earth rotation animation feature coming soon!');
        }

        // Utility Functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function openModal(imageUrl, title, description) {
            const modal = document.getElementById('detailModal');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <img src="${imageUrl}" alt="${title}">
                <h3>${title}</h3>
                <p>${description}</p>
                <div class="gallery-item-actions">
                    <button class="btn btn-primary" onclick="downloadImage('${imageUrl}', '${title}')">
                        <i class="fas fa-download"></i> Download HD
                    </button>
                    <button class="btn btn-secondary" onclick="shareContent('${title}', '${imageUrl}')">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            `;
            
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function downloadImage(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename.replace(/[^a-z0-9]/gi, '_').toLowerCase() + '.jpg';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function shareContent(title, url) {
            if (navigator.share) {
                navigator.share({
                    title: title,
                    url: url
                });
            } else {
                navigator.clipboard.writeText(`${title}: ${url}`).then(() => {
                    alert('Link copied to clipboard!');
                });
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('detailModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>